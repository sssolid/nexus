{% extends "base.html" %}
{% load crispy_forms_tags %}

{% block title %}My Profile - Crown Nexus{% endblock %}

{% block content %}
<div class="container">
    <div class="row">
        <div class="col-md-3">
            <!-- Profile Sidebar -->
            <div class="card">
                <div class="card-body text-center">
                    <i class="fas fa-user-circle fa-5x text-muted mb-3"></i>
                    <h5>{{ user.get_full_name|default:user.email }}</h5>
                    <p class="text-muted">
                        {% if user.is_customer %}
                            <span class="badge bg-primary">Customer</span>
                        {% elif user.is_employee %}
                            <span class="badge bg-success">Employee</span>
                            {% if user.employee_role %}
                                <span class="badge bg-info">{{ user.get_employee_role_display }}</span>
                            {% endif %}
                        {% endif %}
                    </p>
                    <small class="text-muted">
                        Member since {{ user.date_joined|date:"M Y" }}
                    </small>
                </div>
            </div>

            <!-- Quick Links -->
            <div class="card mt-3">
                <div class="card-header">
                    <h6 class="mb-0">Quick Links</h6>
                </div>
                <div class="list-group list-group-flush">
                    {% if user.is_customer %}
                        <a href="{% url 'exports:export_list' %}" class="list-group-item list-group-item-action">
                            <i class="fas fa-download"></i> My Exports
                        </a>
                        <a href="{% url 'validator:upload' %}" class="list-group-item list-group-item-action">
                            <i class="fas fa-check-circle"></i> Data Validator
                        </a>
                    {% endif %}
                    {% if user.is_employee %}
                        <a href="/admin/" class="list-group-item list-group-item-action">
                            <i class="fas fa-cog"></i> Django Admin
                        </a>
                        <a href="/cms/" class="list-group-item list-group-item-action">
                            <i class="fas fa-edit"></i> Wagtail CMS
                        </a>
                    {% endif %}
                </div>
            </div>
        </div>

        <div class="col-md-9">
            <!-- Profile Form -->
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-user-edit"></i> Profile Information</h5>
                </div>
                <div class="card-body">
                    <form method="post">
                        {% csrf_token %}
                        
                        <h6 class="border-bottom pb-2 mb-3">Personal Information</h6>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">First Name</label>
                                    <input type="text" class="form-control" value="{{ user.first_name }}" readonly>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Last Name</label>
                                    <input type="text" class="form-control" value="{{ user.last_name }}" readonly>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Email</label>
                            <input type="email" class="form-control" value="{{ user.email }}" readonly>
                        </div>

                        {% if user.company_name %}
                        <div class="mb-3">
                            <label class="form-label">Company</label>
                            <input type="text" class="form-control" value="{{ user.company_name }}" readonly>
                        </div>
                        {% endif %}

                        {% if user.customer_number %}
                        <div class="mb-3">
                            <label class="form-label">Customer Number</label>
                            <input type="text" class="form-control" value="{{ user.customer_number }}" readonly>
                        </div>
                        {% endif %}

                        <h6 class="border-bottom pb-2 mb-3 mt-4">Profile Settings</h6>
                        
                        {{ form|crispy }}
                        
                        <div class="d-grid gap-2 mt-4">
                            <button type="submit" class="btn btn-primary btn-lg">
                                <i class="fas fa-save"></i> Save Changes
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Account Statistics -->
            {% if user.is_customer %}
            <div class="card mt-3">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-chart-bar"></i> Account Activity</h5>
                </div>
                <div class="card-body">
                    <div class="row text-center">
                        <div class="col-md-4">
                            <h3 class="text-primary">{{ user.export_jobs.count }}</h3>
                            <p class="text-muted">Total Exports</p>
                        </div>
                        <div class="col-md-4">
                            <h3 class="text-success">CHECK TEMPLATE{# {{ user.validation_jobs.filter.status='COMPLETED'.count }} #}</h3>
                            <p class="text-muted">Validations</p>
                        </div>
                        <div class="col-md-4">
                            <h3 class="text-info">{{ user.last_login|date:"M d, Y" }}</h3>
                            <p class="text-muted">Last Login</p>
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
